<% @page_title = "View Submission" %>

<p>
  <%= link_to "Back to Assignment: #{@assignment.name}", @assignment %>

  <% if @logged_in_user.course_admin?(@course) %>
    | <%= link_to "Grade this Submission", [:edit, @submission] %>
  <% end %>
</p>

<h1>Submission</h1>

<table class="pretty-list">
  <tr>
    <td><strong>Assignment</strong></td>
    <td><%= @submission.assignment.name %></td>
  </tr>
  <tr>
    <td><strong>Student</strong></td>
    <td><%= @submission.user.name %></td>
  </tr>
  <tr>
    <td><strong>Submitted File</strong></td>
    <td><%= link_to @submission.file_name, @submission.file_path %></td>
  </tr>
  <tr>
    <td><strong>Student Notes</strong></td>
    <td><%= @submission.student_notes %></td>
  </tr>
</table>

<h1>Score</h1>

<table class="pretty-list">
<tr>
  <td>Automatic Score:</td>
  <td><%= @submission.raw_score || "no data" %> / 
    <%= @assignment.points_available %></td>
</tr>
<tr>
  <td>Teacher Score:</td>
  <td><%= show_score(@submission.teacher_score) || "no data" %> / 
    <%= @assignment.points_available %></td>
</tr>
<% if @submission.late? %>
<tr>
  <td>Days Late:</td>
  <td><%= @submission.days_late %></td>
</tr>
<tr>
  <td>Late Penalty:</td>
  <td><%= 100.0 * @submission.late_penalty %>%</td>
</tr>
<% end %>
<tr>
  <td>Current Score:</td>
  <td><%= show_score(@submission.score) %> /
    <%= @assignment.points_available %></td>
</tr>
</table>

<h1>Teacher Notes</h1>

<% if @assignment.hide_grading? %>

<p>(Teacher notes have not yet been shared.)</p>

<% end %>

<% if (not @assignment.hide_grading?) or @logged_in_user.course_admin?(@course) %>

<div>
<%= raw @submission.teacher_notes || 'no data' %>
</div>

<% end %>

<h1>Grading Process</h1>

<pre>
<% # Lack of indentation important here. %>
<%= @submission.grading_output %>
</pre>

<script>
  function reload_bottom() {
    window.location.href = "<%= url_for(@submission) + '#bottom' %>";
    window.location.reload(true);
  }
</script>


<p id="bottom"><%= link_to_function "Refresh Output", "reload_bottom();" %></p>
